semver-checks:
  stage: test
  image: rust:$RUST_VERSION
  variables:
    BINSTALL_DISABLE_TELEMETRY: "true"
    GIT_DEPTH: 0
  rules:
    - if: $CI_PIPELINE_SOURCE == "merge_request_event" && $CI_MERGE_REQUEST_TARGET_BRANCH_NAME == "master"
      changes:
        - clients/rust/**/*
        - Cargo.*
  before_script:
    - rustc --version && cargo --version
    - curl -L --proto '=https' --tlsv1.2 -sSf https://raw.githubusercontent.com/cargo-bins/cargo-binstall/main/install-from-binstall-release.sh | bash
    - cargo binstall --target x86_64-unknown-linux-musl --no-confirm cargo-semver-checks@0.44.0
    - git fetch origin master
  script:
    - echo "Checking semver compliance against origin/master..."
    # Check SDK - strict
    - cargo semver-checks --package hook0-client --baseline-rev origin/master || (echo "WARNING: SDK has breaking changes - ensure MAJOR version bump" && exit 1)
  allow_failure: false
